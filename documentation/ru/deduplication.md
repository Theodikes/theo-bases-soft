## Общее описание и примеры

Удаляет все совпадающие строки из файла. Создаёт новый файл, в который записывает все строки без повторений, исходный файл не изменяется. Учитывает пробельные символы, то есть, если в одной строке в конце два пробела, а в другой один - это разные строки. Работает с любыми строками, это не обязательно должны быть базы.

**Пример:** входной файл `test.txt`, команда `theo d test.txt`, итоговый файл - `test_dedup_1.txt`

*test.txt*

```
test@gmail.com:test

test@gmail.com:password

somestring@test.com:test
test@gmail.com:password
```

*test_dedup_1.txt*

```
test@gmail.com:test

test@gmail.com:password
somestring@test.com:test
```

Как видно, пустые строки тоже считаются дубликатами и удаляются. Записывается в итоговый файл всегда только первое совпадение, все повторы, идущие ниже, не записываются.

При выполнении данной команды по умолчанию для удаления дубликатов используется оперативная память. Всего памяти будет занято не более 85% от размера входного файла, если в нём строки средней длины не менее 20 символов. При недостатке оперативной памяти для обработки файла, программа прямо во время выполнения может перейти на использование дискового пространства для сохранения временных данных, что сильно замедлит выполнение, однако позволит удалять дубликаты из баз, практически неограниченных по размеру.



## Опции запуска

#### Основные опции:

-  `--memory` - число от 1 до 100. Общий максимальный процент используемой оперативной памяти, после достижения которой программа переходит на использование дискового пространства для удаления дубликатов. Значение по умолчанию - 90. То есть, если все процессы на вашем устройстве в сумме будут использовать более 90% от имеющейся оперативной памяти, дедупликатор начнёт использовать диск и не будет больше наращивать использование оперативки. Желательно не менять значение данного параметра без веских на то причин.

  **Внимание!** После перехода на использование дисковой памяти, уже занятая программой оперативная память не освободится до удаления всех дубликатов.



#### Файловые опции:

- `-m` или `--merge` - булев (логический) параметр. Если в команде пользователь передал сразу несколько файлов на дедупликацию, во всех этих файлах вместе ищутся дубликаты, и уникальные строки без дубликатов записываются в один итоговый файл.
  Значение по умолчанию - `false`.
  
  **Пример 1:** команда `theo d --merge test1.txt test2.txt`
  
  *файл test1.txt в рабочей директории*
  
  ```
  somestring
  random
  random
  login:pass
  ```
  
  *файл test2.txt в рабочей директории*
  
  ```
  somestring
  firstpart:lastpart
  login:pass
  invalid;
  ```
  
  *итоговый файл dedup_merged.txt в рабочей директории*
  
  ```
  somestring
  random
  firstpart:lastpart
  login:pass
  invalid;
  ```
  
  В итоге строки, одинаковые в двух файлах, дедуплицированы, и в итоговый файл попадает лишь одна копия каждой из совпадающих строк.
  
  **Пример 2:** выполняется команда `theo d test1.txt test2.txt` в консоли
  
  *файл test1.txt в рабочей директории*
  
  ```
  somestring
  random
  random
  login:pass
  ```
  
  *файл test2.txt в рабочей директории*
  
  ```
  somestring
  firstpart:lastpart
  login:pass
  invalid;
  ```
  
  *итоговый файл test1_dedup_1.txt в рабочей директории*
  
  ```
  somestring
  random
  login:pass
  ```
  
  *итоговый файл test2_dedup_1.txt в рабочей директории*
  
  ```
  somestring
  firstpart:lastpart
  login:pass
  invalid;
  ```
  
  Как видно, когда параметр запуска `--merge` не указан, в каждом итоговом файле будут удалены лишь совпадающие строки в соответствующем входном файле (в данном примере оставлена лишь одна строка `random` из первого файла), и совпадений со строками из других переданных файлов программа искать не будет.
  
  
  
- `-d` или `--destination` - путь к итоговой директории, куда будут сложены все дедуплицированные входные файлы (по умолчанию - рабочая директория запуска команды), либо путь к общему итоговому файлу, если указан параметр `--merge` (по умолчанию - файл `dedup_merged.txt` в рабочей директории).

  **Пример 1:** выполняется команда `theo d -d result test.txt subfolder` в рабочей директории

  *рабочая директория*

  ```
  ├── test.txt
  ├── result/
  └── subfolder/                   
      ├── test.txt
      ├── test1.txt
  ```

  *рабочая директория после выполнения команды*

  ```
  ├── test.txt
  └── result/
  	├── test_dedup_1.txt
      ├── test_dedup_2.txt
      ├── test1_dedup_1.txt
  └── subfolder/                   
      ├── test.txt
      ├── test1.txt
  ```

  Как видно, для каждого входного файла создался итоговый файл, в котором будет результат исключительно из уникальных строк соответствующего входного файла.
  Поскольку есть два файла с одинаковыми названиями (`test.txt` в корневой директории и `test.txt` в папке `subfolder`), то в итоговой директории первый обрабатываемый стал `test_dedup_1.txt`, а второй - `test_dedup_2.txt`. Программа работает мягко и никогда не перезаписывает файлы, а просто увеличивает число в конце имени документа.

  **Пример 2:** выполняется команда `theo d -d all_deduplicated.txt --merge test.txt subfolder` в рабочей директории

  *рабочая директория*

  ```
  ├── test.txt
  └── subfolder/                   
      ├── test.txt
      ├── test1.txt
  ```

  *рабочая директория после выполнения команды*

  ```
  ├── test.txt
  └── subfolder/                   
      ├── test.txt
      ├── test1.txt
  ├── all_deduplicated.txt
  ```

  Уникальные строки из объединения всех обрабатываемых текстовых документов сложены в общий итоговый файл -`all_deduplicated.txt`.

  

- `-r` или `--recursive` - обходить ли переданные директории рекурсивно (если они переданы, на файлы никак не влияет). Булев (логический) параметр, по умолчанию false. НЕ требует передачи значения.

  **Пример:** консоль, из которой вызывается программа, открыта в корневой папке.

  *структура папок и файлов в корневой директории примера*

  ```
  ├── test1.txt
  ├── result/  
  └── testfolder/                   
      └── subfolder/
      	├── sub.txt
      ├── test2.txt 
  ```

  При вызове команды `theo d -d result test1.txt testfolder`  будут обработаны только два файла - `test1.txt` из корневой папки и файл самой указанной папки `testfolder` - `test2.txt`
  *структура папок и файлов в корневой директории после выполнения первой команды*

  ```
  ├── test1.txt
  └── result/  
  	├── test1_dedup_1.txt 
  	├── test2_dedup_1.txt 
  └── testfolder/                   
      └── subfolder/
      	├── sub.txt
      ├── test2.txt 
  ```

  

  При вызове команды `theo d -r -d result test1.txt testfolder` в итоговой директории будет результат обработки всех трёх входных файлов: `test1.txt`, `test2.txt` и `sub.txt`. Если бы в папке `subfolder` были ещё подпапки и в них были ещё текстовые документы, они бы тоже были обработаны.

  *структура папок и файлов в корневой директории после выполнения второй команды*

  ```
  ├── test1.txt
  └── result/  
  	├── test1_dedup_1.txt 
  	├── test2_dedup_1.txt 
  	├── sub_dedup_1.txt 
  └── testfolder/                   
      └── subfolder/
      	├── sub.txt
      ├── test2.txt 
  ```

  

